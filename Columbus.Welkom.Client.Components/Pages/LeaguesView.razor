@page "/leagues"
@using Columbus.Welkom.Application.Models
@using Columbus.Welkom.Application.Models.ViewModels
@using Columbus.Welkom.Application.Services.Interfaces
@inject IOwnerService OwnerService
@inject ILeaguesService LeagueService

<RadzenStack AlignItems="AlignItems.Start" Orientation="Orientation.Vertical">
    <RadzenText TextStyle="TextStyle.DisplayH6">
        Divisiespel
    </RadzenText>

    <RadzenDropDown Data="_allOwners"
                    SelectAllText="Iedereen"
                    Style="min-width: 400px;"
                    @bind-Value="_leagues.AllParticipants"
                    Multiple="true">
        <Template>
            @((context as LeagueOwner)!.Owner.Id): @((context as LeagueOwner)!.Owner.Name)
        </Template>
    </RadzenDropDown>

    @foreach (League league in _leagues.GetLeagues())
    {
        <RadzenText TextStyle="TextStyle.Subtitle1">
            @league.Name
        </RadzenText>
        <RadzenDataGrid Data="_leagues.GetLeagueOwnersByLeagueRank(league.Rank)"
                        IsLoading="_leagues is null"
                        EmptyText="Geen leden in deze divisie.">
            <Columns>
                <RadzenDataGridColumn TItem="LeagueOwner" Title="Lidnummer" Property="@nameof(LeagueOwner.Owner.Id)">
                    <Template Context="leagueOwner">
                        @leagueOwner.Owner.Id
                    </Template>
                </RadzenDataGridColumn>
                <RadzenDataGridColumn TItem="LeagueOwner" Title="Naam" Property="@nameof(LeagueOwner.Owner.Name)">
                    <Template Context="leagueOwner">
                        @leagueOwner.Owner.Name
                    </Template>
                </RadzenDataGridColumn>
                <RadzenDataGridColumn TItem="LeagueOwner" Title="Punten" Property="@nameof(LeagueOwner.Points)" />
                <RadzenDataGridColumn TItem="LeagueOwner" Title="" Width="100px">
                    <Template>
                        <RadzenButton ButtonStyle="ButtonStyle.Success"
                                      Icon="arrow_upward"
                                      Click="@(() => _leagues!.Promote(context))"
                                      Disabled="true" />
                        <RadzenButton ButtonStyle="ButtonStyle.Danger"
                                      Icon="arrow_downward"
                                      Click="@(() => _leagues!.Demote(context))" />
                    </Template>
                </RadzenDataGridColumn>
            </Columns>
        </RadzenDataGrid>
    }
</RadzenStack>

@code {
    [CascadingParameter(Name = "Club")]
    public int Club { get; set; }
    [CascadingParameter(Name = "Year")]
    public int Year { get; set; }

    private Leagues _leagues = new([]);
    private IEnumerable<LeagueOwner> _allOwners = [];

    protected override async Task OnParametersSetAsync()
    {
        await base.OnParametersSetAsync();

        //_allOwners = await OwnerService.GetOwnersByYearWithAllPigeonsAsync(Year);
        //_leagues = LeagueService.GetStorage(Club, Year) ?? new Leagues(new List<LeagueOwner>());
    }
}
